(()=>{var ce=Object.create;var V=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var D=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var xe=(r,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ue(e))!fe.call(r,a)&&a!==s&&V(r,a,{get:()=>e[a],enumerable:!(i=Ae(e,a))||i.enumerable});return r};var H=(r,e,s)=>(s=r!=null?ce(de(r)):{},xe(e||!r||!r.__esModule?V(s,"default",{value:r,enumerable:!0}):s,r));var Z=D((Ee,K)=>{"use strict";K.exports=()=>{let r={};return r.promise=new Promise((e,s)=>{r.resolve=e,r.reject=s}),r}});var G=D((Se,J)=>{"use strict";var pe=Z();function he(r,e="maxAge"){let s,i,a,p=async()=>{if(s!==void 0)return;let d=async b=>{a=pe();let N=b[1][e]-Date.now();if(N<=0){r.delete(b[0]),a.resolve();return}return s=b[0],i=setTimeout(()=>{r.delete(b[0]),a&&a.resolve()},N),typeof i.unref=="function"&&i.unref(),a.promise};try{for(let b of r)await d(b)}catch{}s=void 0},c=()=>{s=void 0,i!==void 0&&(clearTimeout(i),i=void 0),a!==void 0&&(a.reject(void 0),a=void 0)},u=r.set.bind(r);return r.set=(d,b)=>{r.has(d)&&r.delete(d);let N=u(d,b);return s&&s===d&&c(),p(),N},p(),r}J.exports=he});var Q=D((Pe,Y)=>{"use strict";var be=G(),L=class{constructor(e,s){if(this.maxAge=e,this[Symbol.toStringTag]="Map",this.data=new Map,be(this.data),s)for(let[i,a]of s)this.set(i,a)}get size(){return this.data.size}clear(){this.data.clear()}delete(e){return this.data.delete(e)}has(e){return this.data.has(e)}get(e){let s=this.data.get(e);if(s)return s.data}set(e,s){return this.data.set(e,{maxAge:Date.now()+this.maxAge,data:s}),this}values(){return this.createIterator(e=>e[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(e=>[e[0],e[1].data])}forEach(e,s){for(let[i,a]of this.entries())e.apply(s,[a,i,this])}[Symbol.iterator](){return this.entries()}*createIterator(e){for(let s of this.data.entries())yield e(s)}};Y.exports=L});var re=D((W,ee)=>{(function(r,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof W<"u")e(ee);else{var s={exports:{}};e(s),r.browser=s.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:W,function(r){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",s=i=>{let a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class p extends WeakMap{constructor(n,g=void 0){super(g),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}let c=t=>t&&typeof t=="object"&&typeof t.then=="function",u=(t,n)=>(...g)=>{i.runtime.lastError?t.reject(new Error(i.runtime.lastError.message)):n.singleCallbackArg||g.length<=1&&n.singleCallbackArg!==!1?t.resolve(g[0]):t.resolve(g)},d=t=>t==1?"argument":"arguments",b=(t,n)=>function(m,...f){if(f.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${d(n.minArgs)} for ${t}(), got ${f.length}`);if(f.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${d(n.maxArgs)} for ${t}(), got ${f.length}`);return new Promise((w,k)=>{if(n.fallbackToNoCallback)try{m[t](...f,u({resolve:w,reject:k},n))}catch(o){console.warn(`${t} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),m[t](...f),n.fallbackToNoCallback=!1,n.noCallback=!0,w()}else n.noCallback?(m[t](...f),w()):m[t](...f,u({resolve:w,reject:k},n))})},N=(t,n,g)=>new Proxy(n,{apply(m,f,w){return g.call(f,t,...w)}}),C=Function.call.bind(Object.prototype.hasOwnProperty),h=(t,n={},g={})=>{let m=Object.create(null),f={has(k,o){return o in t||o in m},get(k,o,T){if(o in m)return m[o];if(!(o in t))return;let A=t[o];if(typeof A=="function")if(typeof n[o]=="function")A=N(t,t[o],n[o]);else if(C(g,o)){let R=b(o,g[o]);A=N(t,t[o],R)}else A=A.bind(t);else if(typeof A=="object"&&A!==null&&(C(n,o)||C(g,o)))A=h(A,n[o],g[o]);else if(C(g,"*"))A=h(A,n[o],g["*"]);else return Object.defineProperty(m,o,{configurable:!0,enumerable:!0,get(){return t[o]},set(R){t[o]=R}}),A;return m[o]=A,A},set(k,o,T,A){return o in m?m[o]=T:t[o]=T,!0},defineProperty(k,o,T){return Reflect.defineProperty(m,o,T)},deleteProperty(k,o){return Reflect.deleteProperty(m,o)}},w=Object.create(t);return new Proxy(w,f)},l=t=>({addListener(n,g,...m){n.addListener(t.get(g),...m)},hasListener(n,g){return n.hasListener(t.get(g))},removeListener(n,g){n.removeListener(t.get(g))}}),P=new p(t=>typeof t!="function"?t:function(g){let m=h(g,{},{getContent:{minArgs:0,maxArgs:0}});t(m)}),v=new p(t=>typeof t!="function"?t:function(g,m,f){let w=!1,k,o=new Promise(I=>{k=function(M){w=!0,I(M)}}),T;try{T=t(g,m,k)}catch(I){T=Promise.reject(I)}let A=T!==!0&&c(T);if(T!==!0&&!A&&!w)return!1;let R=I=>{I.then(M=>{f(M)},M=>{let F;M&&(M instanceof Error||typeof M.message=="string")?F=M.message:F="An unexpected error occurred",f({__mozWebExtensionPolyfillReject__:!0,message:F})}).catch(M=>{console.error("Failed to send onMessage rejected reply",M)})};return R(A?T:o),!0}),E=({reject:t,resolve:n},g)=>{i.runtime.lastError?i.runtime.lastError.message===e?n():t(new Error(i.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?t(new Error(g.message)):n(g)},y=(t,n,g,...m)=>{if(m.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${d(n.minArgs)} for ${t}(), got ${m.length}`);if(m.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${d(n.maxArgs)} for ${t}(), got ${m.length}`);return new Promise((f,w)=>{let k=E.bind(null,{resolve:f,reject:w});m.push(k),g.sendMessage(...m)})},S={devtools:{network:{onRequestFinished:l(P)}},runtime:{onMessage:l(v),onMessageExternal:l(v),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},O={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":O},services:{"*":O},websites:{"*":O}},h(i,S,a)};r.exports=s(chrome)}else r.exports=globalThis.browser})});var me=H(Q());var U,ye=new Uint8Array(16);function B(){if(!U&&(U=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!U))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return U(ye)}var x=[];for(let r=0;r<256;++r)x.push((r+256).toString(16).slice(1));function X(r,e=0){return(x[r[e+0]]+x[r[e+1]]+x[r[e+2]]+x[r[e+3]]+"-"+x[r[e+4]]+x[r[e+5]]+"-"+x[r[e+6]]+x[r[e+7]]+"-"+x[r[e+8]]+x[r[e+9]]+"-"+x[r[e+10]]+x[r[e+11]]+x[r[e+12]]+x[r[e+13]]+x[r[e+14]]+x[r[e+15]]).toLowerCase()}var we=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),q={randomUUID:we};function ve(r,e,s){if(q.randomUUID&&!e&&!r)return q.randomUUID();r=r||{};let i=r.random||(r.rng||B)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){s=s||0;for(let a=0;a<16;++a)e[s+a]=i[a];return e}return X(i)}var _=ve;var z=H(re());async function se(r,e,s,i){return fetch(`https://chat.openai.com/backend-api${s}`,{method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(i)})}async function te(r,e){await se(r,"POST","/conversation/message_feedback",e)}async function ne(r,e,s){await se(r,"PATCH",`/conversation/${e}`,s)}function ie(r){let e,s,i,a,p,c,u;return d(),{feed:b,reset:d};function d(){e=!0,s="",i=0,a=-1,p=void 0,c=void 0,u=""}function b(C){s=s?s+C:C,e&&ke(s)&&(s=s.slice(ae.length)),e=!1;let h=s.length,l=0,P=!1;for(;l<h;){P&&(s[l]===`
`&&++l,P=!1);let v=-1,E=a,y;for(let S=i;v<0&&S<h;++S)y=s[S],y===":"&&E<0?E=S-l:y==="\r"?(P=!0,v=S-l):y===`
`&&(v=S-l);if(v<0){i=h-l,a=E;break}else i=0,a=-1;N(s,l,E,v),l+=v+1}l===h?s="":l>0&&(s=s.slice(l))}function N(C,h,l,P){if(P===0){u.length>0&&(r({type:"event",id:p,event:c||void 0,data:u.slice(0,-1)}),u="",p=void 0),c=void 0;return}let v=l<0,E=C.slice(h,h+(v?P:l)),y=0;v?y=P:C[h+l+1]===" "?y=l+2:y=l+1;let S=h+y,O=P-y,t=C.slice(S,S+O).toString();if(E==="data")u+=t?"".concat(t,`
`):`
`;else if(E==="event")c=t;else if(E==="id"&&!t.includes("\0"))p=t;else if(E==="retry"){let n=parseInt(t,10);Number.isNaN(n)||r({type:"reconnect-interval",value:n})}}}var ae=[239,187,191];function ke(r){return ae.every((e,s)=>r.charCodeAt(s)===e)}async function*oe(r){let e=r.getReader();try{for(;;){let{done:s,value:i}=await e.read();if(s)return;yield i}}finally{e.releaseLock()}}async function ge(r,e){let{onMessage:s,...i}=e,a=await fetch(r,i);if(!a.ok){let c=(await a.json().catch(()=>({}))).detail;throw new Error(c||`${a.status} ${a.statusText}`)}let p=ie(c=>{c.type==="event"&&s(c.data)});for await(let c of oe(a.body)){let u=new TextDecoder().decode(c);p.feed(u)}}var $="accessToken",j=new me.default(10*1e3);async function le(){if(j.get($))return j.get($);let r=await fetch("https://chat.openai.com/api/auth/session");if(r.status===403)throw new Error("CLOUDFLARE");let e=await r.json().catch(()=>({}));if(!e.accessToken)throw new Error("UNAUTHORIZED");return j.set($,e.accessToken),e.accessToken}async function Te(r,e){let s=await le(),i,a=()=>{i&&ne(s,i,{is_visible:!1})},p=new AbortController;r.onDisconnect.addListener(()=>{p.abort(),a()}),await ge("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:p.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({action:"next",messages:[{id:_(),role:"user",content:{content_type:"text",parts:[e]}}],model:"text-davinci-002-render",parent_message_id:_()}),onMessage(c){if(console.debug("sse message",c),c==="[DONE]"){r.postMessage({event:"DONE"}),a();return}let u=JSON.parse(c),d=u.message?.content?.parts?.[0];i=u.conversation_id,d&&r.postMessage({text:d,messageId:u.message.id,conversationId:u.conversation_id})}})}z.default.runtime.onConnect.addListener(r=>{r.onMessage.addListener(async e=>{console.debug("received msg",e);try{await Te(r,e.question)}catch(s){console.error(s),r.postMessage({error:s.message}),j.delete($)}})});z.default.runtime.onMessage.addListener(async r=>{if(r.type==="FEEDBACK"){let e=await le();await te(e,r.data)}});})();
